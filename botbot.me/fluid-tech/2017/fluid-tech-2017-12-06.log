b'2017-12-06T00:32:27 * the-t-in-rtf joined the channel
2017-12-06T00:37:21 * colinclark joined the channel
2017-12-06T00:58:17 * colinclark has quit
2017-12-06T01:48:21 * alanharnum joined the channel
2017-12-06T02:43:32 * mrtyler joined the channel
2017-12-06T02:49:29 * alanharnum joined the channel
2017-12-06T03:51:05 * alanharnum joined the channel
2017-12-06T04:35:08 * grrrero has quit
2017-12-06T04:51:44 * alanharnum joined the channel
2017-12-06T04:56:26 * alanharnum has quit
2017-12-06T05:52:16 * alanharnum joined the channel
2017-12-06T05:57:10 * alanharnum has quit
2017-12-06T06:53:02 * alanharnum joined the channel
2017-12-06T06:57:56 * alanharnum has quit
2017-12-06T07:53:55 * alanharnum joined the channel
2017-12-06T08:04:32 * the-t-in-rtf has quit
2017-12-06T08:13:01 * kasparnet joined the channel
2017-12-06T08:54:34 * alanharnum joined the channel
2017-12-06T08:59:25 * alanharnum has quit
2017-12-06T09:08:26 * the-t-in-rtf joined the channel
2017-12-06T09:23:54 * alanharnum joined the channel
2017-12-06T09:32:18 * kasparnet has quit
2017-12-06T09:40:11 * stegru joined the channel
2017-12-06T10:02:36 * kasparnet joined the channel
2017-12-06T10:37:34 * stegru has quit
2017-12-06T10:48:19 * amatas joined the channel
2017-12-06T10:58:42 * kasparnet_ joined the channel
2017-12-06T11:42:23 * kasparnet_ has quit
2017-12-06T12:02:05 * stegru joined the channel
2017-12-06T12:15:19 * gtirloni joined the channel
2017-12-06T13:04:16 * grrrero joined the channel
2017-12-06T13:20:10 * Justin_o joined the channel
2017-12-06T14:00:16 * simonjb joined the channel
2017-12-06T14:07:01 * clown joined the channel
2017-12-06T14:07:11 <simonjb> hi there gtirloni, thanks very much for your Docker work! would you have some time to chat about it? I\'d like to ask you about security/isolation details
2017-12-06T14:08:34 <gtirloni> hi there! I have some time now until 9:45, then i\'m available after 12pm
2017-12-06T14:09:30 <simonjb> gtirloni: if it\'s good, let\'s chat now then for a bit
2017-12-06T14:09:47 <gtirloni> ok
2017-12-06T14:09:48 <simonjb> gtirloni: what platform is best?
2017-12-06T14:10:02 <simonjb> vidyo/skype/hangouts?
2017-12-06T14:10:09 <gtirloni> skype, if you don\'t mind
2017-12-06T14:12:28 * cindyli joined the channel
2017-12-06T14:17:13 * alanharnum joined the channel
2017-12-06T14:44:40 * alanharnum joined the channel
2017-12-06T14:57:36 * the-t-in-rtf joined the channel
2017-12-06T15:00:23 * mrtyler joined the channel
2017-12-06T15:15:21 * cindyli joined the channel
2017-12-06T15:20:51 * alanharnum has quit
2017-12-06T15:25:15 * avtar joined the channel
2017-12-06T15:26:00 * michelled joined the channel
2017-12-06T15:40:35 * kasparnet has quit
2017-12-06T15:54:50 * simonjb joined the channel
2017-12-06T15:58:30 * the-t-in-rtf joined the channel
2017-12-06T15:59:59 * kasparnet joined the channel
2017-12-06T16:00:10 * the-t-in-rtf has quit
2017-12-06T16:35:50 * the-t-in-rtf joined the channel
2017-12-06T18:03:44 * kasparnet has quit
2017-12-06T18:29:04 * cindyli has quit
2017-12-06T19:06:46 * stegru has quit
2017-12-06T19:11:56 * colinclark joined the channel
2017-12-06T19:13:22 * cindyli joined the channel
2017-12-06T19:18:09 * michelled joined the channel
2017-12-06T19:19:25 * clown has quit
2017-12-06T19:22:17 * clown joined the channel
2017-12-06T19:22:23 * clown is now known as clown_afk
2017-12-06T19:30:58 * kasparnet joined the channel
2017-12-06T19:35:08 * gtirloni has quit
2017-12-06T19:35:33 * gtirloni joined the channel
2017-12-06T19:47:33 * simonjb has quit
2017-12-06T20:11:03 * michelled joined the channel
2017-12-06T20:11:27 * colinclark has quit
2017-12-06T20:11:47 * colinclark joined the channel
2017-12-06T20:17:35 * cindyli joined the channel
2017-12-06T20:18:14 * simonjb joined the channel
2017-12-06T20:31:13 * jhernandez has quit
2017-12-06T20:31:39 * simonjb has quit
2017-12-06T20:35:13 * javjarfer[m] has quit
2017-12-06T20:35:28 * gloob has quit
2017-12-06T20:48:00 * jhernandez joined the channel
2017-12-06T20:53:46 * gtirloni_ joined the channel
2017-12-06T20:56:12 * colinclark has quit
2017-12-06T20:56:57 * gtirloni has quit
2017-12-06T20:57:08 * colinclark joined the channel
2017-12-06T21:00:14 * stegru joined the channel
2017-12-06T21:02:45 * michelled joined the channel
2017-12-06T21:04:00 * cindyli joined the channel
2017-12-06T21:07:35 * kasparnet has quit
2017-12-06T21:09:06 * colinclark joined the channel
2017-12-06T21:17:09 * simonjb joined the channel
2017-12-06T21:22:22 * clown joined the channel
2017-12-06T21:23:06 <simonjb> hi gtirloni_
2017-12-06T21:23:42 <simonjb> looking at the seccomp policy and not sure how to interpret -- do you have time to walk me through or have pointer to documentation that I could read?
2017-12-06T21:23:47 <simonjb> and I\'m thinking being JSON, we don\'t have a good way to add comments, right?
2017-12-06T21:27:50 <gtirloni_> hi, yes.. no good way to add comments. it\'s basically listing the syscalls that are allowed (because the default, at the top, is to err out)
2017-12-06T21:28:40 <gtirloni_> i tried to allow only the syscalls that node/npm needed but the seccomp policy gets applied to early, so i had to allow some syscalls that only needed by the container runtime (to start the container, spawn new processes, etc)
2017-12-06T21:29:01 <simonjb> and the group starting at line 362 "personality"?
2017-12-06T21:30:23 <simonjb> https://github.com/gtirloni-gpii/nexus-dist/blob/140a58785a5b64e6ae55aeeb76fa5fe5faec6301/nexus-seccomp.json#L362-L446
2017-12-06T21:31:06 * colinclark has quit
2017-12-06T21:31:20 <gtirloni_> node/npm would segfault without that.. \'process execution domain\'.. http://man7.org/linux/man-pages/man2/personality.2.html
2017-12-06T21:31:37 <simonjb> thanks
2017-12-06T21:31:41 * colinclark joined the channel
2017-12-06T21:32:23 <simonjb> are there names that we could use in place of the numeric values?
2017-12-06T21:32:39 <simonjb> wish we could add comments :(
2017-12-06T21:33:07 <gtirloni_> i don\'t think so, let me check
2017-12-06T21:34:31 <gtirloni_> these are the structs that are used to deserialize that content (i don\'t see useful constants for the values) https://github.com/docker/engine-api/blob/c15549e10366236b069e50ef26562fb24f5911d4/types/seccomp.go
2017-12-06T21:36:50 <simonjb> gtirloni_: I\'m reading the doc https://docs.docker.com/engine/security/seccomp/
2017-12-06T21:37:10 <simonjb> looks like there is a default profile, if you don\'t specify one
2017-12-06T21:37:47 <gtirloni_> yes, that\'s the one i based this profile on
2017-12-06T21:38:09 <gtirloni_> https://github.com/moby/moby/blob/master/profiles/seccomp/default.json
2017-12-06T21:38:29 <simonjb> thanks
2017-12-06T21:38:40 <simonjb> the page does say "It is not recommended to change the default seccomp profile."
2017-12-06T21:38:55 <simonjb> I\'m thinking that ours is more restrictive?
2017-12-06T21:38:57 * ussjoin_ has quit
2017-12-06T21:39:02 <gtirloni_> yes
2017-12-06T21:39:26 <gtirloni_> ours doesn\'t allow connect() and elevating privileges by asking for capabilities
2017-12-06T21:39:37 <simonjb> great
2017-12-06T21:40:45 <gtirloni_> maybe it\'s possible to restrict the exec* syscalls so the node process cannot start any new processes, but from what I saw, it would also restrict the container runtime process from exec\'ing() (and thus it wouldn\'t be able to execute node).. i still need to test a bit more
2017-12-06T21:40:53 <simonjb> is there risk in maintaining our own that things will be added to the default in the future that we will miss -- I\'m thinking we should be ok as it\'s a whitelist rather than a blacklist? does that seem reasonable?
2017-12-06T21:41:46 <simonjb> as long as a call or feature is disabled by default and needs to be explicitly enabled
2017-12-06T21:42:34 <gtirloni_> i think it\'s possible to layer policies on top of each other (e.g. use the default one, and layer a blacklist on top of it), but in the example i provided we\'re using ours only, so the default can change as much as it wants
2017-12-06T21:43:10 <simonjb> interesting
2017-12-06T21:43:37 <gtirloni_> (i think the layering thing was requested in some docker issue i read, but i don\'t see anything in seccomp itself that does that. maybe someone was asking for that feature, can\'t remember now)
2017-12-06T21:45:35 <gtirloni_> in my example i used this too: https://www.projectatomic.io/blog/2016/03/no-new-privs-docker/
2017-12-06T21:48:28 <gtirloni_> with the vagrant image we can ensure seccomp is being applied when we start the container. for people working with docker natively, they have to specify it in `docker run`... so there\'s that also. maybe a wrapper script can help for less technical users.
2017-12-06T21:48:32 * gtirloni_ is now known as gtirloni
2017-12-06T21:50:46 <simonjb> gtirloni: we aren\'t planning on running Nexus on S390 :)
2017-12-06T21:50:59 <gtirloni> hehe less things to worry about i guess
2017-12-06T21:51:03 <gtirloni> fewer
2017-12-06T21:51:04 <simonjb> I\'m diffing yours against the default
2017-12-06T21:51:07 <simonjb> :)
2017-12-06T21:51:07 <gtirloni> ok
2017-12-06T21:51:27 <simonjb> I\'m totally pro-removing stuff
2017-12-06T21:52:24 <simonjb> I think keeping the formatting the same as the default is good to facilitate convenient diffing
2017-12-06T21:53:14 <simonjb> (as you have done)
2017-12-06T21:53:45 <simonjb> this looks great, thanks gtirloni
2017-12-06T21:54:25 * michelled has quit
2017-12-06T21:54:27 <gtirloni> cool! like i said, i\'m refreshing my knowledge of fork/clone/exec* to see if we can lock it down further.. let\'s see, at least no new connections will be opened with that (i hope)
2017-12-06T21:56:03 <simonjb> gtirloni: am I correct in interpreting the "caps" blocks that you have removed as granting permissions based on capabilities that the process has been given? with them removed, as in your version, they will be denied even if the process if given the capabilities?
2017-12-06T21:56:32 <simonjb> process *is* given the capabilities
2017-12-06T21:56:37 <gtirloni> yes, exactly. no matter if capabilities are being asked, they won\'t be given additional access except for what we already listed in the big syscall list
2017-12-06T21:57:00 <simonjb> got it
2017-12-06T21:57:57 <gtirloni> the remaining stuff that is not in the big list is for specific syscalls and parameters.. you see some capabilities mentioned but they\'re in the "excludes" part, because if those capabilities are given.. then don\'t bother filtering those syscalls because the process already has broad access
2017-12-06T21:59:02 * colinclark has quit
2017-12-06T22:02:00 * ussjoin_ joined the channel
2017-12-06T22:40:57 * colinclark joined the channel
2017-12-06T22:44:11 * gtirloni has quit
2017-12-06T22:48:43 * avtar has quit
2017-12-06T22:59:11 * amatas has quit
2017-12-06T23:28:13 * stegru has quit
2017-12-06T23:39:34 * Justin_o has quit
'

