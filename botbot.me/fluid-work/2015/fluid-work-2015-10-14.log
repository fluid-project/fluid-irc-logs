b'2015-10-14T17:19:31 <clown> by "it" I mean the solution.
2015-10-14T17:19:48 * clown is firing up the production device reporter...
2015-10-14T17:20:30 <cindyli> simonjb: updated
2015-10-14T17:21:19 <simonjb> Bosmon7: what would be a good way to do the config file deletion? when is it safe to delete the file? is there a good mechanism I could use to make sure it gets deleted even in case of an exception?
2015-10-14T17:21:21 <jhernandez> clown: yeah, and it (the gpii) won\'t report it (the extension) as installed
2015-10-14T17:21:25 <jhernandez> :)
2015-10-14T17:21:26 <Bosmon7> simonjb - just a few stylistic nits - i) I think the configuration would be more reusable if the large JSON block beginning at line 47 were assigned to a global path rather than being stuck in a function - then you can clone it in the function and assign in the child configs using fluid.set, ii) there is a slightly eccentric spelling of "Cloud" in the events : P
2015-10-14T17:21:50 <Bosmon7> simonjb - I think using the QUnit callbacks is probably safest, let me see if I can find an example
2015-10-14T17:21:57 <clown> jhernandez, running the production device reporter, and using "http://localhost:8081/device":  the "com.ilunion.cloud4chrome" shows up.
2015-10-14T17:22:02 <simonjb> thanks Bosmon7
2015-10-14T17:22:25 <clown> in other words, the solution "com.ilunion.cloud4chrome" is reported as "installed".
2015-10-14T17:22:40 <simonjb> Bosmon7: will move JSON to a global path and fix spelling :)
2015-10-14T17:22:57 <simonjb> thanks a lot for looking it over
2015-10-14T17:24:15 <clown> jhernandez, nope.  I was running in development mode.  My bad.  :-(
2015-10-14T17:24:17 <Bosmon7> simonjb - so I think that adding a listener to this event would be a reasonable approach - https://github.com/fluid-project/node-jqUnit/blob/master/lib/jqUnit-node.js#L103
2015-10-14T17:24:23 <jhernandez> clown: well, how the hell we can have different behaviors?
2015-10-14T17:24:24 <jhernandez> ok ok
2015-10-14T17:24:25 <jhernandez> xD
2015-10-14T17:26:53 <jhernandez> that solution is missing the isInstalled block - which is my fault since I merged it
2015-10-14T17:27:37 <clown> okay.  running in production mode (really), the solution does not show up.  Confirming that if \'isInstalled\' is missing, the solution is not reported.
2015-10-14T17:28:46 * kasparnet has quit
2015-10-14T17:28:59 <Bosmon7> simonjb - if you want to be really secure you could add a utility in gpii\'s "Testing.js" that goes through the full machinery described in this report.... http://stackoverflow.com/questions/14031763/doing-a-cleanup-action-just-before-node-js-exits
2015-10-14T17:29:29 <Bosmon7> But simply adding the onAllTestsDone listener would be of equivalent quality to any of our other FS-based tests
2015-10-14T17:29:42 <Bosmon7> These will presumably also leave garbage if the process is killed by an OS signal or whatever
2015-10-14T17:35:55 <simonjb> Bosmon7: ok, I\'ll start with using onAllTestsDone
2015-10-14T17:39:42 * colinclark joined the channel
2015-10-14T17:45:24 * michelled has quit
2015-10-14T17:58:08 * kasparnet joined the channel
2015-10-14T18:09:24 * clown joined the channel
2015-10-14T18:13:07 * danayo has quit
2015-10-14T18:13:31 * danayo joined the channel
2015-10-14T18:15:32 * michelled joined the channel
2015-10-14T18:17:40 * alanharnum joined the channel
2015-10-14T18:48:32 <Justin_o> colinclark, Bosmon7: if i want to use a string template in my publish module any recommendations. I figure i could write my own based off of the string template function in infusion, or use a templating engine or string-template module
2015-10-14T18:48:46 <colinclark> :(
2015-10-14T18:49:37 <Justin_o> i don\'t think ES6 template strings are supported in node yet
2015-10-14T18:49:42 <Justin_o> at least not the version i\'m running
2015-10-14T18:50:08 <Justin_o> which by the way look a lot like the references in our prototrees :(
2015-10-14T18:50:09 <Justin_o> https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings
2015-10-14T18:51:11 <colinclark> https://nodejs.org/en/docs/es6/
2015-10-14T18:51:15 <colinclark> 4.x supports them
2015-10-14T18:51:20 <colinclark> but we\'re not there yet
2015-10-14T18:53:00 <Justin_o> colinclark: my module currently will require at least node 0.12.0 for execSync support
2015-10-14T18:55:26 <colinclark> cool
2015-10-14T18:55:48 <colinclark> There must just be hundreds of string template micromodules out there
2015-10-14T18:56:07 <colinclark> If there\'s one you want to use, I\'d suggest going for it
2015-10-14T18:56:26 <colinclark> and we can think more seriously about it when we are getting to the point of modularizing Infusion itself
2015-10-14T18:57:31 <Justin_o> colinclark: okay thanks
2015-10-14T19:00:30 * danayo joined the channel
2015-10-14T19:23:02 * colinclark joined the channel
2015-10-14T19:24:56 * cindyli has quit
2015-10-14T19:25:47 * cindyli joined the channel
2015-10-14T19:25:48 * alanharnum joined the channel
2015-10-14T19:37:13 * cindyli joined the channel
2015-10-14T20:06:19 * colinclark joined the channel
2015-10-14T20:42:23 * anvk has quit
2015-10-14T21:18:41 * gtirloni joined the channel
2015-10-14T22:56:30 * kasparnet has quit
2015-10-14T23:06:56 * kasparnet joined the channel
2015-10-14T23:37:42 * kasparnet has quit
2015-10-14T23:48:04 * kasparnet joined the channel
'

b'2015-10-14T00:02:00 * jhung joined the channel
2015-10-14T00:29:42 * colinclark has quit
2015-10-14T07:19:02 * slim_ joined the channel
2015-10-14T07:35:31 * kasparnet joined the channel
2015-10-14T08:32:07 * kasparnet has quit
2015-10-14T08:56:42 * kasparnet joined the channel
2015-10-14T11:14:34 * slim_ has quit
2015-10-14T11:17:23 * slim_ joined the channel
2015-10-14T11:36:08 * jhung joined the channel
2015-10-14T12:33:52 * simonjb joined the channel
2015-10-14T12:35:25 * Justin_o joined the channel
2015-10-14T12:38:06 * gtirloni joined the channel
2015-10-14T12:40:51 * simonjb joined the channel
2015-10-14T12:47:46 * cindyli joined the channel
2015-10-14T13:29:02 * alanharnum joined the channel
2015-10-14T13:30:36 * sepidehshahi joined the channel
2015-10-14T13:49:49 * clown joined the channel
2015-10-14T13:58:03 <simonjb> hi Bosmon, I was wondering if you had some time to take a look at the tests I\'ve put together following our conversation on Friday? https://github.com/simonbates/universal/blob/GPII-1224/tests/UntrustedDevelopmentTests.js
2015-10-14T13:58:25 * anvk joined the channel
2015-10-14T14:04:20 * danayo joined the channel
2015-10-14T14:10:44 <simonjb> Bosmon: couple of things left to do (1) the config for the cloud side (currently using the Easit example) and (2) deleting the generated config from disk after the test
2015-10-14T14:11:23 * michelled joined the channel
2015-10-14T14:12:03 * kasparnet has quit
2015-10-14T14:12:40 * kasparnet joined the channel
2015-10-14T14:15:40 <simonjb> Bosmon: actually, maybe the Easit config is the right one
2015-10-14T14:15:58 * kasparnet has quit
2015-10-14T14:16:18 * kasparnet joined the channel
2015-10-14T14:28:11 <simonjb> Bosmon: ok, no, cloudBased.development.all.local is probably the one to go with
2015-10-14T14:28:42 <simonjb> as that one includes gpii.flowManager.cloudBased.oauth2
2015-10-14T14:43:15 * simonjb joined the channel
2015-10-14T14:47:39 * jhung joined the channel
2015-10-14T14:53:34 <alanharnum> gtirloni: i\'m experimenting with building gpii-preferences-server Docker containers using the Ansible roles, as we\'ve discussed previously - ran into a small issue & made a PR to fix it, if you have time to review: https://github.com/idi-ops/ansible-nodejs/pull/8
2015-10-14T14:55:57 <gtirloni> alanharnum: hi, are they going to run as root? is the app going to run as root? i didn\'
2015-10-14T14:56:04 <gtirloni> t understand the issue
2015-10-14T14:58:49 <alanharnum> gtirloni: if running Ansible within a Docker container as part of the container build process, you don\'t need to elevate privileges to execute arbitrary commands (npm install, etc)
2015-10-14T14:59:03 <alanharnum> whereas under VMs / etc you do
2015-10-14T14:59:18 <gtirloni> yep, the become is to actually decrease privileges
2015-10-14T14:59:43 <alanharnum> hm
2015-10-14T14:59:48 <gtirloni> so the cmds run as the app\'s user instead
2015-10-14T14:59:53 <alanharnum> ok
2015-10-14T15:00:05 <alanharnum> this PR may be invalid then
2015-10-14T15:00:20 <alanharnum> the basic issue is that there\'s no \'sudo\' in the Docker image
2015-10-14T15:01:19 <alanharnum> though from what you\'re saying maybe there should be
2015-10-14T15:02:21 <gtirloni> i don\'t know if docker supports other methods of \'becoming\', how that they\'ve generalized the sudo capability..   it seems docker\'s best practices say it\'s better to run the app as its own user even though it\'s inside the container, so we were going for that iirc.
2015-10-14T15:02:40 <alanharnum> yeah, that makes sense
2015-10-14T15:03:49 <alanharnum> let me see if adding sudo to the container build fixes this
2015-10-14T15:05:09 <gtirloni> i wonder why they removed sudo, is that based on the centos:7 image?
2015-10-14T15:05:35 <alanharnum> i\'m starting from gpii/universal
2015-10-14T15:06:24 <alanharnum> which i believe is ultimately based off the inclusivedesign/centos image
2015-10-14T15:07:15 <gtirloni> one issue with the dependencies in gpii/universal is that is specifies exact versions of centos, node, etc... when running the costing report tests i had to rebuild everything without specific versions, but i hadn\'t the time to test it thoroughly and submit a PR sadly (https://hub.docker.com/r/gtirloni)
2015-10-14T15:11:00 * colinclark joined the channel
2015-10-14T15:11:06 <alanharnum> ok since this is just experimental i\'ll go from gtirloni/universal instead
2015-10-14T15:11:21 <alanharnum> which i remember avtar advising me to do when i was doing something similar to this a few months back
2015-10-14T15:16:25 <colinclark> hey Justin_o, what\'s up?
2015-10-14T15:16:30 <Justin_o> colinclark: hey
2015-10-14T15:16:53 <Justin_o> colinclark: so couple of questions 1) should we create an npm organization https://docs.npmjs.com/getting-started/working-with-orgs
2015-10-14T15:17:24 <Justin_o> colinclark: 2) should the publish script i\'m working on be a node-module itself.. kind of like the dedupe-infusion one.. i\'m leaning towards yes
2015-10-14T15:17:38 <colinclark> 1) Seems like a good idea
2015-10-14T15:18:21 <colinclark> 2) Will the script be generally useful? i.e. will it have the ability to publish any project based on our release scheme?
2015-10-14T15:18:57 <Justin_o> in regards to 1) my only worry is this beta limitation "Team admins cannot be modified once created. (Team admins have the ability to create new teams and add/remove users in the org to and from teams.)" but i assume that should be removed later.
2015-10-14T15:19:40 <colinclark> You\'d hope so!
2015-10-14T15:20:17 <Justin_o> 2) so the general idea is that you can use it to publish a release, which will just use the current version in the package.json file or publish a dev release which will temporarily set the dev version with the format we have" this all assumes that the version in the package is set to X.x.x-dev
2015-10-14T15:21:52 <Justin_o> oh it could also tag the dev version with "dev" or some other tag
2015-10-14T15:26:48 <colinclark> ok, I think it makes sense to go ahead and make this a module, too
2015-10-14T15:27:00 <colinclark> I guess is will typically be used as a devDependency
2015-10-14T15:27:14 <colinclark> but I think if it has any reusability, it might as well get published
2015-10-14T15:27:21 <colinclark> I wouldn\'t be surprised if teh GPII adopts it
2015-10-14T15:32:02 <Justin_o> colinclark: cool thanks, i\'ll start moving my work over
2015-10-14T15:32:22 <Justin_o> colinclark: any name suggestions.. i\'ve been calling it publish but that might be too generic
2015-10-14T15:32:38 <Justin_o> colinclark: and are you okay with 1) or should we wait till it\'s out of beta?
2015-10-14T15:32:44 <colinclark> describe to me in one short sentence what it does, Justin_o?
2015-10-14T15:32:57 <colinclark> Justin_o: I don\'t mind either way, regarding #1
2015-10-14T15:33:04 <colinclark> if you think it\'s useful already, go for it
2015-10-14T15:33:11 <colinclark> otherwise, let\'s wait till it bakes a bit further
2015-10-14T15:41:56 * michelled has quit
2015-10-14T15:50:34 <Justin_o> colinclark: it\'s probably fine for now, if we start adding more npm modules though it might help "organize" them better
2015-10-14T15:50:42 <colinclark> yep
2015-10-14T15:50:54 <colinclark> For the dedupe-infusion module, I just copied your list of collaborators
2015-10-14T15:51:07 <colinclark> and I guess for each new module, we\'ll do that manually
2015-10-14T15:51:10 <colinclark> until we have an org
2015-10-14T15:51:24 <Justin_o> colinclark: yes, seems to be a reasonable process
2015-10-14T15:53:48 * michelled joined the channel
2015-10-14T15:58:49 * clown joined the channel
2015-10-14T16:06:51 <kasparnet> colinclark: arch meeting if you have time
2015-10-14T16:07:15 <colinclark> kasparnet: I wish I could join you, but I\'m moderating at the DEEP conference today
2015-10-14T16:07:28 <colinclark> http://deep.idrc.ocadu.ca/
2015-10-14T16:18:56 * gtirloni joined the channel
2015-10-14T16:21:25 <gtirloni> alanharnum: this is a question i had when working with avtar but i couldn\'t figure it out: the vagrantfile has a port forwarding definition, but if i set it to use port 8081, the app inside the VM is still using 8080. do you know where do i tell the app to listen on a different port?
2015-10-14T16:25:14 <alanharnum> gtirloni: which app is this?
2015-10-14T16:25:30 <gtirloni> in this case it\'s the first-discovery tool
2015-10-14T16:25:46 <alanharnum> is it being installed with the ansible role?
2015-10-14T16:26:07 <gtirloni> yes
2015-10-14T16:27:29 <gtirloni> i only found the port being used during the tests phase, but nowhere else that influenced the app
2015-10-14T16:27:44 <alanharnum> yeah that\'s the same thing i\'m seeing
2015-10-14T16:27:59 <alanharnum> there\'s nodejs_app_tcp_port but that appears to only be for telling the role what port the app runs on
2015-10-14T16:28:08 <alanharnum> not configuring it to start on another one
2015-10-14T16:28:40 <gtirloni> :q
2015-10-14T16:28:42 <gtirloni> oops
2015-10-14T16:30:49 <gtirloni> at least in that first-discovery-server repo it seems this might be it: src/js/firstDiscoveryServer.js
2015-10-14T16:31:16 <gtirloni> i wonder how to integrate that during the provisioning phase :(
2015-10-14T16:31:20 <alanharnum> there should be a way from command line to start the node app on a different port
2015-10-14T16:32:23 <alanharnum> so the systemd or supervisor config could run (pseudocode): "node index.js -port 8081" or similar
2015-10-14T16:32:53 <gtirloni> right, agreed
2015-10-14T16:33:11 * Bosmon7 joined the channel
2015-10-14T16:33:47 <gtirloni> Bosmon: is there a way to specify which port gpii-express, kettle, etc, should use.. from the command line? any environment var?
2015-10-14T16:36:56 <alanharnum> gtirloni: while waiting on Bosmon, a question in turn - installing sudo on the Docker image gets a step further, but it dies on permissions issues when trying to run \'npm install\' as the nodejs user within the application install directory
2015-10-14T16:37:22 <alanharnum> this feels a lot like the issues we saw with Justin_o under Vagrant
2015-10-14T16:37:57 <alanharnum> working with the container interactively, it seems run successfully if I chown the application install directory to the nodejs user
2015-10-14T16:38:10 <alanharnum> but i\'m hesitant to say this is the solution since it doesn\'t seem to have been required in other contexts
2015-10-14T16:38:12 <alanharnum> thoughts?
2015-10-14T16:41:04 <gtirloni> ah, the git clone task is performed as root. i think avtar and i discussed that while investigating a different issue (the git module doesn\'t offer a way to set the owner).. looks like a candidate for the same become/become_user options
2015-10-14T16:41:53 <alanharnum> ok so i\'m on the right track at least
2015-10-14T16:42:22 <gtirloni> so far we\'ve enumerated 3 scenarios: production app, development app with nodemon, development app without nodemon (but on vagrant), ... docker is another one. looks of tasks and permutations :)
2015-10-14T16:43:00 <alanharnum> yeah this is mostly about wanting to understand provisioning Docker containers via Ansible roles
2015-10-14T16:43:18 <alanharnum> but it\'s become a sideline into making the ansible-nodejs role work in the container
2015-10-14T16:43:36 <alanharnum> which is valuable
2015-10-14T16:48:44 <gtirloni> no doubt, we do need to have the nodejs role taking care of containers.. if not for development, then definitely for production deployments. that\'s is _very_ valuable
2015-10-14T16:49:07 <alanharnum> obvious problem with become for the git clone is that if we want to install into /opt, we need to be cloning as root
2015-10-14T16:49:28 <alanharnum> so maybe it makes sense to clone as root and then chown to the application user?
2015-10-14T16:50:04 * simonjb has quit
2015-10-14T16:50:40 <gtirloni> i think that works. another option would be to create the target dir first hand and then point git (with become) there, but i can\'t find an advantage/disadvantage between both approaches
2015-10-14T16:51:12 <gtirloni> in any case, yeah, we do not need to play with the permissions
2015-10-14T16:58:38 <gtirloni> (this reminded me of this http://www.jamiembrown.com/blog/one-in-every-600-websites-has-git-exposed/  -- which i think we\'re not particularly exposed to by using git this way, the app code isn\'t being made available to anyone... unless there is a bug in the app, in which case we have bigger problems?)
2015-10-14T16:59:29 <alanharnum> some of my thoughts around provisioning Docker containers with Ansible when I was talking with Avtar was to have a pre-production "removal" layer
2015-10-14T16:59:42 <alanharnum> which uninstalls git, ansible, and anything else we need solely for provisioning
2015-10-14T16:59:47 * simonjb joined the channel
2015-10-14T16:59:55 * simonjb_ joined the channel
2015-10-14T16:59:55 <alanharnum> to reduce both security issues & container "weight"
2015-10-14T17:00:03 * simonjb has quit
2015-10-14T17:00:06 * simonjb_ joined the channel
2015-10-14T17:00:25 <gtirloni> sounds like a good idea!
2015-10-14T17:06:46 * slim_ has quit
2015-10-14T17:07:04 <cindyli> simonjb, Justin_o: i\'ve updated the GPII OAUTH 2 wiki page with the new support of https://wiki.gpii.net/w/GPII_OAuth_2_Guide#Client_Credentials_Grant - https://wiki.gpii.net/w/GPII_OAuth_2_Guide. Your feedback is welcome. thanks.
2015-10-14T17:11:03 <simonjb> thanks cindyli, could you move the "Authorization Code Grant" and "Client Credentials Grant" up to top level items?
2015-10-14T17:11:50 <cindyli> simonjb: sure, so remove the heading of "https://wiki.gpii.net/w/GPII_OAuth_2_Guide#Supported_OAuth_2.0_Grant_Types"
2015-10-14T17:11:52 <simonjb> cindyli: 1. Intro 2. Supported... 3. Auth Code 4. Client Cred... 5. Solution Reg 6. Resources
2015-10-14T17:12:37 <cindyli> simonjb: ok
2015-10-14T17:15:02 <clown> kasparnet, Bosmon, sgithens:  regarding missing \'isInstalled\' blocks, I found an instance in the linux.json solutions test data for "com.ilunion.cloud4chrome".
2015-10-14T17:15:11 * clown is getting the github url.
2015-10-14T17:15:57 <clown> https://github.com/GPII/universal/blob/master/testData/solutions/linux.json#L1452
2015-10-14T17:16:25 <clown> Every other solution in that file does have an \'isInstalled\' block.
2015-10-14T17:16:59 <jhernandez> yup clown
2015-10-14T17:17:03 <jhernandez> I was just checking it
2015-10-14T17:17:22 <jhernandez> and yeah, it\'s missing
2015-10-14T17:18:46 <Bosmon7> Hi there simonjb, I was just looking over your GPII-1224 branch for the hybrid flow manager tests - I think this is looking really excellent
2015-10-14T17:18:51 <clown> jhernandez, it does show up here:  com.ilunion.cloud4chrome
2015-10-14T17:18:57 <clown> oops
2015-10-14T17:19:05 <clown> https://github.com/GPII/universal/blob/master/testData/deviceReporter/installedSolutions.json#L67
2015-10-14T17:19:09 <Bosmon7> This is just what was imagining should work, if everything went well
2015-10-14T17:19:27 <simonjb> ok, awesome, thanks Bosmon7
'

